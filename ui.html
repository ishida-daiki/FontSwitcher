<Style>
  /* Reset CSS */
  html, body, div, span, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, abbr, address, cite, code, del, dfn, em, img, ins, kbd, q, samp, small, strong, sub, sup, var, b, i, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, figcaption, figure, footer, header, hgroup, menu, nav, section, summary, time, mark, audio, video {
    margin:0;
    padding:0;
    border:0;
    outline:0;
    font-size:100%;
    vertical-align:baseline;
    background:transparent;
    list-style: none;
  }
  body {
    margin: 0;
    background-color: var(--figma-color-bg);
    color: var(--figma-color-text);
    font-family: 'Inter';
    font-size: 11px;
    font-weight: 400;
    width: 100%;
  }
  .tabList {
    position: relative;
    border-bottom: 1px var(--figma-color-border) solid;
    padding-left: 1rem;
    padding-right: 1rem;
    height: 40px;
  }
  .tabList__items {
    display: flex;
    gap: 4px;
    color: var(--figma-color-text-onselected);
    height: 100%;
  }
  .tabList__item {
    display: flex;
    align-items: center;
    margin-right: 0.5rem;
    cursor: pointer;
    height: 100%;
  }
  .tabList__text {
    font-size: .75rem;
    font-weight: bold;
    color: var(--figma-color-text-disabled);
  }
  /* 選択されたタブのテキストスタイル */
  .tabList__item--active .tabList__text {
    /* 太字にする */
    color: var(--figma-color-text);
  }
  /* 選択インジケーターのスタイル */
  .tabList-active-indicator {
    height: 2px; /* インジケーターの高さ */
    background-color: var(--figma-color-bg-component); /* インジケーターの色 */
    width: 100%; /* インジケーターの幅をタブの幅に合わせる */
    position: absolute; /* インジケーターの位置を絶対指定 */
    bottom: -1px; /* インジケーターをタブの下端に位置するように */
    left: 0;
  }
  /* 非アクティブなタブを隠す */
  .tabList-active-indicator--inactive {
    display: none;
  }
  .button-submit {
    padding: 0.8rem 1.5rem;
    width: 100%;
    border-radius: 30px;
    font-weight: 600;
  }
  .button-submit.disabled {
    border: var(--figma-color-border-disabled);
    color: var(--figma-color-text-disabled);
    background: var(--figma-color-bg-disabled);;
  }
  .button-submit.active {
    border: var(--figma-color-border-component);
    color: var(--figma-color-text-onbrand);
    background: var(--figma-color-bg-component);
  }
  .button-submit.active:hover {
    cursor: pointer;
    color: var(--figma-color-text-onbrand);
    background: var(--figma-color-bg-component-hover);
  }
  .button-submit.active:active {
    color: var(--figma-color-text-onbrand);
    background: var(--figma-color-bg-component-pressed);
  }
  .container {
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin: 16px;
  }
  .error {
    color: var(--figma-color-text-danger);
  }

  .tabList__content {
    gap: 8px;
    display: flex;
    flex-direction: column;
  }
  .tabList__title {
    font-weight: 700;
  }
  .tabList__layer-container {
    display: flex;
    justify-content: space-between;
    cursor: pointer;
    padding: 4 12px;
    border-radius: 4px;
    background: var(--figma-color-bg);
    border: 1px  var(--figma-color-border) solid;
    align-items: center;
  }
  .tabList__layer-container:hover {
    background: var(--figma-color-bg-hover);
  }
  .tabList__layer-container.active {
    background: var(--figma-color-bg);
    border: 1px var(--figma-color-border-oncomponent) solid;
  }
  .tabList__layer-contents {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .tabList__options-button {
    height: 32px;
    border-radius: 2px;
    border: none;
    background: none;
    cursor: pointer;
  }
  .tabList__options-button:hover {
    background: var(--figma-color-bg-tertiary);
  }
  .tabList__layer-content {
    font-weight: 400;
  }
  

  .listContainer {
    overflow: auto;
    padding: 0;
    height: 96px;
  }
  .listMessage {
    display: grid;
    place-content: center;
    height: 100%;
    background-color: var(--figma-color-bg-secondary);
    padding: 0 16px;
    line-height: 1.5;
  }
  .center {
    text-align: center;
  }
  .text {
    padding-top: 1px;
    color: var(--figma-color-text-disabled);
    pointer-events: none;
  }
  .container__border {
    height: 1px;
    background: var(--figma-color-border);
  }
  .tabList__svg {
    fill: var(--figma-color-icon);
    width: 16;
    height: 6;
  }
  /* ローディングインジケーターのスタイル */
  .loading-indicator {
    /* 必要に応じて他のスタイルを追加 */
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    /* background: rgba(255, 255, 255, 0.75); */
    background: var(--figma-color-bg-inverse);
    display: flex;
    flex-direction: column;
    align-content: center;
    align-items: center;
    opacity: 95%;
  }
  .progress-ring {
    width: 240px;
    height: 240px;
  }
  .progress-ring__circle {
    transition: stroke-dashoffset 0.35s;
    transform: rotate(-90deg);
    transform-origin: 50% 50%;
  }
  .progress-text {
    color: var(--figma-color-text-oninverse);
  }

  /* 非表示にするためのクラス */
  .hidden {
    display: none;
  }

</Style>
<body>
  <!-- tabList -->
  <div class="tabList">
    <ul class="tabList__items">
      <li class="tabList__item">
        <span class="tabList__text">Apply Styles</span>
      </li>
      <li class="tabList__item">
        <span class="tabList__text">Create Style</span>
      </li>
    </ul>
    <div class="tabList-active-indicator"></div>
  </div>

  <div class="container">
    <div class="listContainer">
      <div class="listMessage">
        <p class="text center">Select the element whose <br> text you want to change</p>
      </div>
    </div>
    <div class="container__border"></div>
    <div class="tabList__content">
      <h2 class="tabList__title">Select Style</h2>
      <ul class="tabList__layer-contents">
        <li class="tabList__layer-container" data-env="mac">
          <h3 class="tabList__layer-content">Mac 環境確認用</h3>
          <button class="tabList__options-button" tabindex="0" aria-label="その他のオプション" data-tooltip-type="text" data-tooltip="その他のオプション">
            <span class="tabList__svg-container">
              <svg class="tabList__svg" 'xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 6">
                <path fill-opacity="1" fill-rule="nonzero" stroke="none" d="M3.5 3c0 .828-.672 1.5-1.5 1.5C1.172 4.5.5 3.828.5 3c0-.828.672-1.5 1.5-1.5.828 0 1.5.672 1.5 1.5zm6 0c0 .828-.672 1.5-1.5 1.5-.828 0-1.5-.672-1.5-1.5 0-.828.672-1.5 1.5-1.5.828 0 1.5.672 1.5 1.5zM14 4.5c.828 0 1.5-.672 1.5-1.5 0-.828-.672-1.5-1.5-1.5-.828 0-1.5.672-1.5 1.5 0 .828.672 1.5 1.5 1.5z"></path>
              </svg>
            </span>
          </button>
        </li>
        <li class="tabList__layer-container" data-env="windows">
          <h3 class="tabList__layer-content">Windows 環境確認用</h3>
          <button class="tabList__options-button" tabindex="0" aria-label="その他のオプション" data-tooltip-type="text" data-tooltip="その他のオプション">
            <span class="tabList__svg-container">
              <svg class="tabList__svg" 'xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 6">
                <path fill-opacity="1" fill-rule="nonzero" stroke="none" d="M3.5 3c0 .828-.672 1.5-1.5 1.5C1.172 4.5.5 3.828.5 3c0-.828.672-1.5 1.5-1.5.828 0 1.5.672 1.5 1.5zm6 0c0 .828-.672 1.5-1.5 1.5-.828 0-1.5-.672-1.5-1.5 0-.828.672-1.5 1.5-1.5.828 0 1.5.672 1.5 1.5zM14 4.5c.828 0 1.5-.672 1.5-1.5 0-.828-.672-1.5-1.5-1.5-.828 0-1.5.672-1.5 1.5 0 .828.672 1.5 1.5 1.5z"></path>
              </svg>
            </span>
          </button>
        </li>
      </ul>
    </div>
    <button id="analyzeBtn" class="button-submit disabled">Apply</button>
    <!-- <button id="analyzeBtn" class="button-submit">Apply</button> -->
  </div>
  <!-- ローディングインジケーターのHTML例 -->
  <div id="loadingIndicator" class="loading-indicator hidden">
    <svg class="progress-ring" viewBox="0 0 240 240">
      <circle
        class="progress-ring__circle"
        stroke="var(--figma-color-bg-component)"
        stroke-width="10"
        fill="transparent"
        r="52"  
        cx="120"
        cy="120"
      />
    </svg>
    <span class="progress-text">Applying fonts...</span> 
</body>

<!-- (240 / 2) - (stroke-width / 2)
SVGの中心点X座標は幅の半分
SVGの中心点Y座標は高さの半分 -->

<script>
  // 要素を取得します。
  const tabs = document.querySelectorAll('.tabList__item');
  const textStyles = document.querySelectorAll('.tabList__layer-container')
  const indicator = document.querySelector('.tabList-active-indicator');
  const loader = document.querySelectorAll('.loading-indicator');

  // 選択された要素とstyleの状態を表示
  let selectedEnv = null;
  let hasSelection = false;
  let isEnvSelected = false;


  // タブが選択された際の関数を定義します。
  function activateTab(tab) {
    // すべてのタブからアクティブクラスを取り除きます。
    tabs.forEach(t => {
      t.classList.remove('tabList__item--active');
    });
    
    // 選択されたタブにアクティブクラスを追加します。
    tab.classList.add('tabList__item--active');
    
    // インジケーターを活性状態にして、選択されたタブの位置に合わせます。
    indicator.style.display = 'block';
    indicator.style.width = '74px';
    indicator.style.left = `${tab.offsetLeft}px`;
  }
  // タブをクリックした際のイベントリスナーを追加します。
  tabs.forEach(tab => {
    tab.addEventListener('click', () => activateTab(tab));
  });
  // 初期状態（ページ読み込み時）で「Apply Styles」タブをアクティブにします。
  activateTab(tabs[0]); // 最初のタブをアクティブとする

  // progress-ring__circleと同じ値をセットし、
  // SVGの円周の長さを計算する式: 2 * Math.PI * r (半径)
  const circumference = 2 * Math.PI * 52;

  // 最初に円をリングとして表示するために、
  // stroke-dasharrayとstroke-dashoffsetを円周の長さにセットします
  const circle = document.querySelector('.progress-ring__circle');
  circle.style.strokeDasharray = `${circumference} ${circumference}`;
  circle.style.strokeDashoffset = circumference;

  function setProgress(percent) {
    // パーセントに応じたオフセットを計算します
    const offset = circumference - (percent / 100 * circumference);
    // オフセットを設定することでリングを描画します
    circle.style.strokeDashoffset = offset;
  }

  // メッセージがプラグインから送信されたときにイベントを発火させる
  window.onmessage = (event) => {
    const message = event.data.pluginMessage;
    // 共通のエレメントを取得
    const textElement = document.querySelector('.listMessage .text.center'); // textElementをここで定義
    const loadingIndicator = document.getElementById('loadingIndicator');

    switch (message.type) {
      // 選択した要素関連メッセージ
      case 'selection-cleared':
        textElement.innerHTML = 'Select the element whose <br> text you want to change'
        textElement.style.color = 'var(--figma-color-text-disabled)';
        textElement.style.fontWeight = '400';
        hasSelection = false;
        updateButtonState();
        break;
      case 'update-name':
        textElement.textContent = message.name;
        textElement.style.color = 'var(--figma-color-text)';
        textElement.style.fontWeight = '600';
        hasSelection = true;
        updateButtonState();
        break;
      
      // ローディング表示関連メッセージ
      // case 'show-loading':
      //   loadingIndicator.classList.remove('hidden');
      case 'update-progress':
        loadingIndicator.classList.remove('hidden');
        // 進捗状況のパーセンテージを受け取る
        const progressPercent = event.data.pluginMessage.progress;
        // 進捗インジケータを更新する
        setProgress(progressPercent);
        break;
      case 'hide-loading':
        loadingIndicator.classList.add('hidden');
        break;
    }
  };

  // Applyボタンの要素を取得し、デフォルトでは無効化する
  const applyBtn = document.getElementById("analyzeBtn"); 
  applyBtn.disabled = true; // 初期状態としてボタンを無効化
  // スタイル選択時のイベントハンドラ
  textStyles.forEach(textStyle => {
    textStyle.addEventListener('click', () => {
      selectedEnv = textStyle.getAttribute('data-env');
      // 他のスタイル名の選択を解除
      textStyles.forEach(ts => ts.classList.remove('active'));
      textStyle.classList.add('active');
      updateButtonState();
    });
  });

  // Applyボタンの初期状態を定義
  applyBtn.disabled = true; // 最初は非活性化しておく

  // Applyボタンの有効/無効ステータスを更新する関数
  function updateButtonState() {
    // selectedEnvがnullでないかをチェックして、isEnvSelectedを更新する
    isEnvSelected = selectedEnv !== null;
    // Applyボタンは環境が選択され、何かが選択されている場合のみ活性化する
    applyBtn.disabled = !(isEnvSelected && hasSelection);

    if (isEnvSelected && hasSelection) {
      applyBtn.classList.remove('disabled');
      applyBtn.classList.add('active');
    } else {
      applyBtn.classList.remove('active');
      applyBtn.classList.add('disabled');
    }
  }

  // UIのHTML中のスクリプトは以下のようになります。
  // UIから送られるメッセージは、上記 figma.ui.onmessage でリッスンされます。
  // When the button is clicked, the plugin will start the text analysis and update
  applyBtn.addEventListener("click", () => {
    parent.postMessage({
        pluginMessage: { 
          type: 'analyzeAndUpdateText',
          fontSettings: {
            env: selectedEnv
          }
        } 
      }, '*');
  });
</script>